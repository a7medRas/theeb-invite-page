<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>كود الدعوة - حدث خاص</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #f6f7fb;
      --card: #fff;
      --text: #1f2937;
      --muted: #6b7280;
      --accent: #a67c52;
      --accent-dark: #8c6b44;
      --ok: #1b5e20;
      --border: #e5e7eb;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius-lg: 22px;
      --radius-md: 14px;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{min-height:100%;font-family:'Cairo',sans-serif;background:var(--bg);color:var(--text)}
    body{display:flex;align-items:flex-start;justify-content:center}
    .wrap{width:min(920px,92%); margin:42px auto 70px;}
    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:var(--radius-lg); box-shadow:var(--shadow);
      padding:30px 28px;
    }
    .h1{font-size:clamp(22px,3.2vw,30px); font-weight:800; text-align:center; margin-bottom:10px;}
    .lead{text-align:center; color:#4b5563; line-height:1.9; font-size:clamp(14px,2.2vw,16px); margin-bottom:18px;}
    .subhead{text-align:center; font-weight:700; margin:8px 0 12px;}
    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:14px; margin:10px 0 18px; border:1px solid var(--border)}
    th,td{padding:12px 12px; border-bottom:1px solid var(--border)}
    th{background:var(--accent); color:#fff; font-weight:700}
    tr:last-child td{border-bottom:none}
    td{background:#fff}
    .field{display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; margin-top:6px}
    .input{flex:1 1 340px; max-width:520px; padding:14px 16px; border:1px solid var(--border); border-radius:999px; background:#fff; font-size:18px; text-align:center; color:#111;}
    .input::placeholder{color:#9ca3af}
    .btn{padding:12px 20px; border:none; border-radius:999px; cursor:pointer; background:var(--accent); color:#fff; font-size:16px; font-weight:700; transition:filter .15s ease;}
    .btn:hover{filter:brightness(1.05)}
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .hint{font-size:13px; color:var(--muted); text-align:center; margin-top:8px}
    .cooldown{font-size:13px; color:var(--accent-dark); text-align:center; margin-top:6px; display:none}
    #inviteCard{display:none; margin-top:18px; background:#faf8f4; border:1px solid #eadfce; border-radius:18px; padding:18px 16px; box-shadow:0 8px 22px rgba(0,0,0,.06)}
    .code{font-size:24px; font-weight:800; color:var(--ok); direction:ltr; text-align:center; margin-bottom:10px}
    .row{display:flex; align-items:center; gap:14px; flex-wrap:wrap; justify-content:center}
    .qr-box{background:#fff; border:1px solid #e9e2d8; border-radius:14px; padding:12px; width:180px;height:180px; display:flex; align-items:center; justify-content:center}
    .preview{flex:1; min-width:260px; display:flex; flex-direction:column; gap:10px; max-width:520px}
    .preview-link{background:#fff; border:1px dashed #d6c7b6; border-radius:12px; padding:12px 10px; color:#111; font-size:14px; line-height:1.6; word-break:break-all; direction:ltr}
    .tools .mini, .share .mini{background:#5e5e5e; color:#fff; border:none; border-radius:10px; padding:9px 14px; font-size:14px; cursor:pointer}
    .tools .mini:hover, .share .mini:hover{filter:brightness(1.08)}
    .tools .mini.primary{background:var(--accent)}
    .toast{position:fixed; top:16px; right:16px; background:#111c; color:#fff; padding:10px 14px; border-radius:12px; font-size:14px; opacity:0; transform:translateY(-8px); transition:all .25s ease; z-index:10}
    .toast.show{opacity:1; transform:translateY(0)}
    #shareCounter{color:#555; font-size:14px; text-align:center; margin-top:8px}
    .sec-title{text-align:center; font-weight:800; font-size:clamp(18px,2.6vw,22px); margin:18px 0 10px; color:#1f2937;}
    .bonus table th, .bonus table td{text-align:center;}
    /* ألوان النسب في جدول المكافآت الإضافية */
    .bonus tbody tr td:last-child {font-weight: 800; border-radius: 6px;}
    .bonus tbody tr:nth-child(1) td:last-child {background: #e8f5e9; color: #2e7d32;}
    .bonus tbody tr:nth-child(2) td:last-child {background: #e3f2fd; color: #1565c0;}
    .bonus tbody tr:nth-child(3) td:last-child {background: #fff3e0; color: #ef6c00;}
    .bonus tbody tr:nth-child(4) td:last-child {background: #f3e5f5; color: #6a1b9a;}
    .bonus tbody tr:nth-child(5) td:last-child {background: #fff8e1; color: #b28900;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1 class="h1">احصل على كود الدعوة الخاص بك 🎉</h1>
      <p class="lead">
        هذا الحدث متاح لجميع مذيعين الوكالة. يمكن لكل مذيع الحصول
        على كود دعوة خاصة به ودعوة أشخاص جدد والحصول على مكافآت تصل
        إلى <b>$1000</b> شهريًا.
      </p>
      <div class="subhead">شروط الحصول على المكافأة:</div>
      <p class="lead" style="margin-top:-4px">
        1- أن يجتاز المذيع المدعو مرحلة الأوديشن. <br>
        2- أن يحقق 31 ساعة خلال أول شهر.
      </p>
      <table aria-label="جدول المكافآت">
        <thead><tr><th>نوع الدعوة</th><th>المكافأة</th></tr></thead>
        <tbody>
          <tr><td>مذيع من داخل الشرق الأوسط</td><td>2$</td></tr>
          <tr><td>مذيع من دول الخليج</td><td>4$</td></tr>
        </tbody>
      </table>

      <!-- جدول المكافآت الإضافية -->
      <section class="bonus">
        <h3 class="sec-title">المكافآت الإضافية – نسبة من تارجيت المدعو</h3>
        <p class="lead" style="margin-top:-4px; text-align:center; color:#4b5563; line-height:1.8">
          يحصل الداعي على مكافأة لمدة <b>3 شهور متتالية</b> في حال قام المذيع المدعو
          بتحقيق التارجيت بنفسه، تصل المكافأة إلى <b>25%</b> حسب الجدول التالي:
        </p>
        <table aria-label="جدول نسب المكافآت الإضافية">
          <thead><tr><th>شريحة التارجيت (USD)</th><th>نسبة المكافأة للداعي</th></tr></thead>
          <tbody>
            <tr><td>من 2,000 إلى 50,000</td><td>2%</td></tr>
            <tr><td>من 80,000 إلى 220,000</td><td>8%</td></tr>
            <tr><td>من 300,000 إلى 800,000</td><td>15%</td></tr>
            <tr><td>من 1,000,000 إلى 5,000,000</td><td>20%</td></tr>
            <tr><td>من 6,500,000 إلى 10,000,000</td><td>25%</td></tr>
          </tbody>
        </table>
        <p class="hint" style="margin-top:8px">
          * تُحتسب النسبة على قيمة التارجيت المحقق لكل شهر، وتصرف لمدة 3 شهور متتالية
          طالما استوفى المدعو الشروط.
        </p>
      </section>

      <div class="field">
        <input id="likeeId" class="input" placeholder="اكتب Likee ID — حروف وأرقام إنجليزية فقط (3 رموز+)" inputmode="latin" autocomplete="off" />
        <button id="genBtn" class="btn" onclick="generateCode()">احصل على الكود</button>
      </div>
      <p class="hint">أمثلة صالحة: <span dir="ltr">adam123</span> • <span dir="ltr">L1K33Star9</span></p>
      <div id="cooldownHint" class="cooldown"></div>

      <section id="inviteCard" aria-live="polite">
        <div class="code" id="inviteCode"></div>
        <div class="row" style="margin-bottom:8px">
          <div class="qr-box"><img id="qrImg" alt="QR" width="160" height="160" /></div>
          <div class="preview">
            <div id="inviteLinkPreview" class="preview-link"></div>
            <div class="row tools">
              <button class="mini primary" onclick="copyCode()">📋 نسخ الكود</button>
              <button class="mini primary" onclick="copyLink()">🔗 نسخ الرابط</button>
              <button class="mini" onclick="downloadCard()">⬇️ تحميل الكارت PNG</button>
            </div>
          </div>
        </div>
        <div class="row share">
          <button class="mini" onclick="share('whatsapp')">واتساب</button>
          <button class="mini" onclick="share('telegram')">تيليجرام</button>
          <button class="mini" onclick="share('messenger')">ماسنجر</button>
          <button class="mini" onclick="share('copy')">نسخ النص</button>
        </div>
        <p id="shareCounter"></p>
      </section>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    const $ = s => document.querySelector(s);
    const likeeInput = $("#likeeId");
    const genBtn = $("#genBtn");
    const inviteCard = $("#inviteCard");
    const codeArea = $("#inviteCode");
    const linkPreview = $("#inviteLinkPreview");
    const qrImg = $("#qrImg");
    const cooldownHint = $("#cooldownHint");
    const toastEl = $("#toast");
    let counter = 0;
    let lastGenTime = 0;
    const COOLDOWN = 5;
    function toast(msg){ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'), 1700); }
    likeeInput.addEventListener('input', () => {
      const cleaned = (likeeInput.value || '').replace(/\s+/g,'').replace(/[^A-Za-z0-9]/g,'');
      if(cleaned !== likeeInput.value) likeeInput.value = cleaned;
    });
    (function init(){
      try{ const saved = localStorage.getItem('likeeId'); if(saved) likeeInput.value = saved; }catch(e){}
      const p = new URLSearchParams(location.search);
      const urlCode = p.get('code'); if(urlCode) showResult(urlCode);
    })();
    function validateId(id){ return /^[A-Za-z0-9]{3,}$/.test(id); }
    function rand4(){ return Math.floor(1000 + Math.random()*9000); }
    function inviteLink(inviteCode){ const base = location.origin + location.pathname; return base + '?code=' + encodeURIComponent(inviteCode); }
    function startCooldown(){
      const start = Date.now();
      genBtn.disabled = true; cooldownHint.style.display = 'block';
      const tick = () => {
        const remain = Math.max(0, COOLDOWN - Math.floor((Date.now()-start)/1000));
        cooldownHint.textContent = '⏳ الرجاء الانتظار ' + remain + ' ث قبل توليد كود جديد.';
        if(remain <= 0){ genBtn.disabled = false; cooldownHint.style.display = 'none'; }
        else setTimeout(tick, 250);
      }; tick();
    }
    function generateCode(){
      const now = Date.now();
      if(now - lastGenTime < COOLDOWN*1000){ startCooldown(); toast('انتظر قليلًا…'); return; }
      const id = (likeeInput.value || '').trim();
      if(!validateId(id)){ toast('❌ Likee ID يجب أن يكون حروف/أرقام إنجليزية فقط وبحد أدنى 3 رموز.'); likeeInput.focus(); return; }
      try{ localStorage.setItem('likeeId', id); }catch(e){}
      const code = `TH-${id}-${rand4()}`;
      showResult(code);
      sendToGoogleSheet(id, code);
      lastGenTime = now; startCooldown();
    }
    function showResult(code){
      codeArea.textContent = code;
      const link = inviteLink(code);
      linkPreview.textContent = link;
      qrImg.src = "https://api.qrserver.com/v1/create-qr-code/?size=170x170&data=" + encodeURIComponent(link);
      qrImg.alt = "QR to " + link;
      inviteCard.style.display = 'block';
      incrementCounter();
    }
    function incrementCounter(){ counter++; $("#shareCounter").innerText = `💡 عدد الأكواد التي تم إنشاؤها/عرضها: ${counter}`; }
    function copyText(t){ navigator.clipboard.writeText(t).then(()=>toast('تم النسخ ✅')); }
    function copyCode(){ const c = codeArea.textContent.trim(); if(c) copyText(c); }
    function copyLink(){ const l = linkPreview.textContent.trim(); if(l) copyText(l); }
    function share(platform){
      const c = codeArea.textContent.trim();
      const l = linkPreview.textContent.trim();
      const text = `📢 كود الدعوة الخاص بي: ${c}\nانضم الآن إلى الحدث!\n${l}`;
      let url = "";
      switch(platform){
        case "whatsapp": url = `https://wa.me/?text=${encodeURIComponent(text)}`; break;
        case "telegram": url = `https://t.me/share/url?url=${encodeURIComponent(l)}&text=${encodeURIComponent('انضم الآن! ' + c)}`; break;
        case "messenger": url = `fb-messenger://share/?link=${encodeURIComponent(l)}&app_id=0`; break;
        case "copy": copyText(text); return;
      }
      window.open(url, '_blank');
    }
    async function downloadCard(){
      try{
        const node = document.getElementById('inviteCard');
        const canvas = await html2canvas(node, {scale:2, useCORS:true});
        const dataURL = canvas.toDataURL('image/png');
        const a = document.createElement('a');
        const name = (codeArea.textContent || 'invite').replace(/\s+/g,'');
        a.href = dataURL; a.download = name + '.png'; a.click();
      }catch(e){ toast('تعذر حفظ الصورة، حاول مجددًا'); }
    }
    function sendToGoogleSheet(likeeId, inviteCode) {
      fetch("https://script.google.com/macros/s/AKfycbwtnLPgvBZJ35GlA75TejT4eQVNPQaWRmBD2r4YvRqNCwY91HF3AXiPn4udTANT4zwv/exec", {
        method: "POST",
        body: new URLSearchParams({ likeeId, inviteCode })
      }).then(r=>r.text()).catch(()=>{});
    }
  </script>
</body>
</html>
