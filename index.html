<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ© - Ø­Ø¯Ø« Ø®Ø§Øµ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#111827">
  <link rel="manifest" href="manifest.json">

  <!-- Ø®Ø· -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Plausible Analytics â€” Ø­Ø¯Ù‘Ø« Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø£Ùˆ Ø§Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø± -->
  <script defer data-domain="theeb.eg" src="https://plausible.io/js/script.js"></script>

  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --text:#1f2937; --muted:#6b7280;
      --accent:#a67c52; --accent-dark:#8c6b44; --ok:#1b5e20;
      --border:#e5e7eb; --shadow:0 10px 30px rgba(0,0,0,.08);
      --radius-lg:22px; --bar-bg:#fff; --bar-text:#111;
      --coin:#f2c94c; --coin-shadow:rgba(0,0,0,.15);
    }
    body.dark{
      --bg:#0f172a; --card:#0b1224; --text:#e5e7eb; --muted:#94a3b8;
      --accent:#d6a65c; --accent-dark:#b1843f; --ok:#34d399;
      --border:#1e293b; --bar-bg:#0b1224; --bar-text:#e5e7eb;
      --coin:#ffd166; --coin-shadow:rgba(255,209,102,.25);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{min-height:100%;font-family:'Cairo',sans-serif;background:var(--bg);color:var(--text)}
    body{display:flex;align-items:flex-start;justify-content:center}
    .wrap{width:min(1040px,94%); margin:18px auto 120px;}

    .topbar{
      display:flex;gap:10px;align-items:center;justify-content:space-between;
      background:var(--bar-bg);border:1px solid var(--border);border-radius:16px;
      box-shadow:var(--shadow);padding:10px 14px;margin-bottom:16px;position:sticky;top:10px;z-index:5
    }
    .counter{display:flex;align-items:center;gap:10px}
    .coin{width:34px;height:34px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #fff7d1, var(--coin));box-shadow:0 4px 10px var(--coin-shadow);animation:spin 2s linear infinite}
    @keyframes spin{0%{transform:rotateY(0)}50%{transform:rotateY(180deg)}100%{transform:rotateY(360deg)}}
    .amount{font-size:20px;font-weight:800;color:var(--bar-text)}
    .amount small{font-weight:600;color:var(--muted);margin-inline-start:6px}
    .top-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .toggleBtn,.ghostBtn{border:none;border-radius:999px;padding:8px 12px;cursor:pointer;color:#fff}
    .toggleBtn{background:var(--accent)} .ghostBtn{background:#5e5e5e}

    .card{background:var(--card);border:1px solid var(--border);border-radius:22px;box-shadow:var(--shadow);padding:24px 20px;margin-top:8px}
    .h1{font-size:clamp(22px,3.2vw,30px);font-weight:800;text-align:center;margin-bottom:10px}
    .lead{text-align:center;color:var(--muted);line-height:1.9;font-size:clamp(14px,2.2vw,16px);margin-bottom:18px}
    .subhead{text-align:center;font-weight:700;margin:8px 0 12px;color:var(--text)}

    table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:14px;margin:10px 0 18px;border:1px solid var(--border)}
    th,td{padding:12px;border-bottom:1px solid var(--border)} th{background:var(--accent);color:#fff;font-weight:700}
    tr:last-child td{border-bottom:none} td{background:var(--card);color:var(--text)}

    .field{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap;margin-top:6px}
    .input{flex:1 1 340px;max-width:520px;padding:14px 16px;border:1px solid var(--border);border-radius:999px;background:#fff;font-size:18px;text-align:center;color:#111}
    body.dark .input{background:#0f172a;color:#e5e7eb;border-color:#1e293b}
    .btn{padding:12px 20px;border:none;border-radius:999px;cursor:pointer;background:var(--accent);color:#fff;font-size:16px;font-weight:700}
    .btn:hover{filter:brightness(1.05)} .btn[disabled]{opacity:.6;cursor:not-allowed}
    .hint{font-size:13px;color:var(--muted);text-align:center;margin-top:8px}
    .cooldown{font-size:13px;color:var(--accent-dark);text-align:center;margin-top:6px;display:none}

    #inviteCard{display:none;margin-top:18px;background:#faf8f4;border:1px solid #eadfce;border-radius:18px;padding:18px 16px;box-shadow:0 8px 22px rgba(0,0,0,.06)}
    body.dark #inviteCard{background:#111827;border-color:#283145}
    .code{font-size:24px;font-weight:800;color:var(--ok);direction:ltr;text-align:center;margin-bottom:10px}
    .row{display:flex;align-items:center;gap:14px;flex-wrap:wrap;justify-content:center}
    .qr-box{background:#fff;border:1px solid #e9e2d8;border-radius:14px;padding:12px;width:180px;height:180px;display:flex;align-items:center;justify-content:center}
    body.dark .qr-box{background:#0f172a;border-color:#1e293b}
    .preview{flex:1;min-width:260px;display:flex;flex-direction:column;gap:10px;max-width:520px}
    .preview-link{background:#fff;border:1px dashed #d6c7b6;border-radius:12px;padding:12px 10px;color:#111;font-size:14px;line-height:1.6;word-break:break-all;direction:ltr}
    body.dark .preview-link{background:#0f172a;border-color:#374151;color:#e5e7eb}
    .tools .mini,.share .mini{background:#5e5e5e;color:#fff;border:none;border-radius:10px;padding:9px 14px;font-size:14px;cursor:pointer}
    .tools .mini.primary{background:var(--accent)}
    #shareCounter{color:var(--muted);font-size:14px;text-align:center;margin-top:8px}

    .sec-title{text-align:center;font-weight:800;font-size:clamp(18px,2.6vw,22px);margin:18px 0 10px;color:var(--text)}
    .bonus table th,.bonus table td{text-align:center}
    .bonus tbody tr td:last-child{font-weight:800;border-radius:6px}
    .bonus tbody tr:nth-child(1) td:last-child{background:#e8f5e9;color:#2e7d32}
    .bonus tbody tr:nth-child(2) td:last-child{background:#e3f2fd;color:#1565c0}
    .bonus tbody tr:nth-child(3) td:last-child{background:#fff3e0;color:#ef6c00}
    .bonus tbody tr:nth-child(4) td:last-child{background:#f3e5f5;color:#6a1b9a}
    .bonus tbody tr:nth-child(5) td:last-child{background:#fff8e1;color:#b28900}

    .sim{margin-top:26px;background:var(--card);border:1px solid var(--border);border-radius:18px;padding:18px 16px}
    .sim .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:10px}
    .sim .input{flex:1 1 220px;max-width:280px}
    .sim .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:10px}
    .stat{background:#fafafa;border:1px dashed #e5e7eb;border-radius:12px;padding:10px;text-align:center;font-size:14px;color:#111}
    body.dark .stat{background:#0f172a;border-color:#334155;color:#e5e7eb}
    .stat b{display:block;font-size:18px;margin-top:6px}
    .chart-wrap{margin-top:14px;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px}

    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.45);z-index:20}
    .modal .box{background:var(--card);border-radius:16px;padding:14px;width:min(900px,95%);border:1px solid var(--border)}
    .modal .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .modal .btns{display:flex;gap:8px;flex-wrap:wrap}
    .x{background:#e11d48;color:#fff;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
    .ghost{background:#5e5e5e;color:#fff;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
    .gold{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
    .poster-wrap{display:flex;justify-content:center;align-items:center;padding:6px}
    canvas.poster{width:100%;height:auto;background:#fff;border-radius:10px}

    .toast{position:fixed;top:16px;right:16px;background:#111c;color:#fff;padding:10px 14px;border-radius:12px;font-size:14px;opacity:0;transform:translateY(-8px);transition:all .25s ease;z-index:30}
    .toast.show{opacity:1;transform:translateY(0)}

    .achv{margin-top:18px;background:var(--card);border:1px dashed var(--border);border-radius:16px;padding:14px}
    .achv-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:10px}
    .badge{display:flex;align-items:center;gap:10px;border:1px solid var(--border);border-radius:12px;padding:10px;background:rgba(166,124,82,.06)}
    .badge.lock{opacity:.6;filter:grayscale(1)}
    .badge .emoji{font-size:20px}
    .badge .t{font-size:14px}
    .badge .t small{display:block;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©: Ø¹Ø¯Ù‘Ø§Ø¯ Ø£Ø±Ø¨Ø§Ø­ + ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ + ØªØµÙÙŠØ± -->
    <div class="topbar">
      <div class="counter">
        <div class="coin" aria-hidden="true"></div>
        <div class="amount" id="liveAmount">0 <small>USD</small></div>
      </div>
      <div class="top-actions">
        <button id="resetBtn" class="ghostBtn">ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯</button>
        <button id="darkToggle" class="toggleBtn">ğŸŒ™/â˜€ï¸ ØªØ¨Ø¯ÙŠÙ„</button>
      </div>
    </div>

    <div class="card">
      <h1 class="h1">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ğŸ‰</h1>
      <p class="lead">Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¯Ø« Ù…ØªØ§Ø­ Ù„Ø¬Ù…ÙŠØ¹ Ù…Ø°ÙŠØ¹ÙŠÙ† Ø§Ù„ÙˆÙƒØ§Ù„Ø©. Ø´Ø§Ø±Ùƒ ÙƒÙˆØ¯Ùƒ ÙˆØ§Ø±Ø¨Ø­ Ù…ÙƒØ§ÙØ¢Øª ØªØµÙ„ Ø¥Ù„Ù‰ <b>$1000</b> Ø´Ù‡Ø±ÙŠÙ‹Ø§.</p>

      <div class="subhead">Ø´Ø±ÙˆØ· Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</div>
      <p class="lead" style="margin-top:-4px">1- Ø§Ø¬ØªÙŠØ§Ø² Ø§Ù„Ø£ÙˆØ¯ÙŠØ´Ù†. <br> 2- ØªØ­Ù‚ÙŠÙ‚ 31 Ø³Ø§Ø¹Ø© ÙÙŠ Ø£ÙˆÙ„ Ø´Ù‡Ø±.</p>

      <!-- Ø¬Ø¯ÙˆÙ„ Ø£Ø³Ø§Ø³ÙŠ -->
      <table aria-label="Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª">
        <thead><tr><th>Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø¹ÙˆØ©</th><th>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</th></tr></thead>
        <tbody><tr><td>Ù…Ø°ÙŠØ¹ Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·</td><td>2$</td></tr><tr><td>Ù…Ø°ÙŠØ¹ Ù…Ù† Ø¯ÙˆÙ„ Ø§Ù„Ø®Ù„ÙŠØ¬</td><td>4$</td></tr></tbody>
      </table>

      <!-- Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© -->
      <section class="bonus">
        <h3 class="sec-title">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© â€“ Ù†Ø³Ø¨Ø© Ù…Ù† ØªØ§Ø±Ø¬ÙŠØª Ø§Ù„Ù…Ø¯Ø¹Ùˆ</h3>
        <p class="lead" style="margin-top:-4px;text-align:center">Ù…ÙƒØ§ÙØ£Ø© ØªÙØµØ±Ù Ù„Ù…Ø¯Ø© <b>3 Ø´Ù‡ÙˆØ±</b> ÙˆØªØµÙ„ Ø¥Ù„Ù‰ <b>25%</b>.</p>
        <table aria-label="Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ø³Ø¨">
          <thead><tr><th>Ø´Ø±ÙŠØ­Ø© Ø§Ù„ØªØ§Ø±Ø¬ÙŠØª (USD)</th><th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ø§Ø¹ÙŠ</th></tr></thead>
          <tbody>
            <tr><td>2,000â€“50,000</td><td>2%</td></tr>
            <tr><td>80,000â€“220,000</td><td>8%</td></tr>
            <tr><td>300,000â€“800,000</td><td>15%</td></tr>
            <tr><td>1,000,000â€“5,000,000</td><td>20%</td></tr>
            <tr><td>6,500,000â€“10,000,000</td><td>25%</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Ø¥Ø¯Ø®Ø§Ù„ Likee ID ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ -->
      <div class="field">
        <input id="likeeId" class="input" placeholder="Ø§ÙƒØªØ¨ Likee ID â€” Ø­Ø±ÙˆÙ/Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø· (3 Ø±Ù…ÙˆØ²+)" inputmode="latin" autocomplete="off" />
        <button id="genBtn" class="btn" onclick="generateCode()">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯</button>
      </div>
      <p class="hint">Ø£Ù…Ø«Ù„Ø©: <span dir="ltr">adam123</span> â€¢ <span dir="ltr">L1K33Star9</span></p>
      <div id="cooldownHint" class="cooldown"></div>

      <!-- ÙƒØ§Ø±Øª Ø§Ù„Ø¯Ø¹ÙˆØ© + Ù…Ø´Ø§Ø±ÙƒØ© -->
      <section id="inviteCard" aria-live="polite">
        <div class="code" id="inviteCode"></div>
        <div class="row" style="margin-bottom:8px">
          <div class="qr-box"><img id="qrImg" alt="QR" width="160" height="160" /></div>
          <div class="preview">
            <div id="inviteLinkPreview" class="preview-link"></div>
            <div class="row tools">
              <button class="mini primary" onclick="copyCode()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
              <button class="mini primary" onclick="copyLink()">ğŸ”— Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
              <button class="mini" onclick="downloadCard()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ø±Øª PNG</button>
              <button class="mini" onclick="openPoster()">ğŸ–¼ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ³ØªØ±</button>
            </div>
          </div>
        </div>
        <div class="row share">
          <button class="mini" onclick="share('whatsapp')">ÙˆØ§ØªØ³Ø§Ø¨</button>
          <button class="mini" onclick="share('telegram')">ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…</button>
          <button class="mini" onclick="share('messenger')">Ù…Ø§Ø³Ù†Ø¬Ø±</button>
          <button class="mini" onclick="share('copy')">Ù†Ø³Ø® Ø§Ù„Ù†Øµ</button>
        </div>
        <p id="shareCounter"></p>
      </section>

      <!-- Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ -->
      <section class="sim" id="sim">
        <h3 class="sec-title">Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙÙˆØ±ÙŠ</h3>
        <div class="controls">
          <input id="simCount" class="input" type="number" min="1" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙŠÙ† (Ù…Ø«Ø§Ù„: 5)" />
          <input id="simTarget" class="input" type="number" min="0" step="100" placeholder="Ù…ØªÙˆØ³Ø· Ø§Ù„ØªØ§Ø±Ø¬ÙŠØª Ù„ÙƒÙ„ Ù…Ø¯Ø¹Ùˆ (USD)" />
          <button class="btn" onclick="runSimulator(true)">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¢Ù†</button>
        </div>
        <p class="hint">* Ø§Ù„Ø­Ø³Ø§Ø¨ ØªÙ‚Ø±ÙŠØ¨ÙŠ ÙˆÙŠÙØªØ±Ø¶ Ù†ÙØ³ Ø§Ù„Ù…ØªÙˆØ³Ø· Ù„Ù„Ø¬Ù…ÙŠØ¹.</p>
        <div class="grid">
          <div class="stat">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø·Ø¨Ù‚Ø© <b id="simPercent">â€”</b></div>
          <div class="stat">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ <b id="simMonthly">â€”</b></div>
          <div class="stat">Ø¥Ø¬Ù…Ø§Ù„ÙŠ 3 Ø´Ù‡ÙˆØ± <b id="simQuarter">â€”</b></div>
          <div class="stat">Ø­Ø¬Ù… Ø§Ù„ØªØ§Ø±Ø¬ÙŠØª Ø§Ù„ÙƒÙ„ÙŠ <b id="simVolume">â€”</b></div>
        </div>
        <div class="chart-wrap"><canvas id="earnChart" height="140" aria-label="Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ"></canvas></div>
      </section>

      <!-- Ø¥Ù†Ø¬Ø§Ø²Ø§Øª -->
      <section class="achv">
        <h3 class="sec-title">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h3>
        <div class="achv-list" id="achvList">
          <div class="badge lock" data-key="first_code"><div class="emoji">ğŸ¯</div><div class="t">Ø£ÙˆÙ„ ÙƒÙˆØ¯<small>ÙˆÙ„Ù‘Ø¯ Ø£ÙˆÙ„ ÙƒÙˆØ¯</small></div></div>
          <div class="badge lock" data-key="ten_codes"><div class="emoji">ğŸ’ª</div><div class="t">10 Ø£ÙƒÙˆØ§Ø¯<small>ÙˆÙ„Ù‘Ø¯ 10 Ø£ÙƒÙˆØ§Ø¯</small></div></div>
          <div class="badge lock" data-key="sim_used"><div class="emoji">ğŸ“Š</div><div class="t">Ø£ÙˆÙ„ Ù…Ø­Ø§ÙƒØ§Ø©<small>Ø´ØºÙ‘Ù„ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ</small></div></div>
          <div class="badge lock" data-key="first_share"><div class="emoji">ğŸ“¤</div><div class="t">Ø£ÙˆÙ„ Ù…Ø´Ø§Ø±ÙƒØ©<small>Ø´Ø§Ø±Ùƒ Ø±Ø§Ø¨Ø·Ùƒ</small></div></div>
          <div class="badge lock" data-key="ten_shares"><div class="emoji">ğŸš€</div><div class="t">10 Ù…Ø´Ø§Ø±ÙƒØ§Øª<small>Ø´Ø§Ø±Ùƒ 10 Ù…Ø±Ø§Øª</small></div></div>
        </div>
      </section>
    </div>

    <!-- Ø¨ÙˆØ³ØªØ± 1080Ã—1080 -->
    <div class="modal" id="posterModal" role="dialog" aria-modal="true" aria-labelledby="posterTitle">
      <div class="box">
        <div class="head">
          <h4 id="posterTitle">Ø¨ÙˆØ³ØªØ± Ø§Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø´Ø®ØµÙŠ (1080Ã—1080)</h4>
        </div>
        <div class="btns" style="padding:0 12px 8px">
          <select id="posterTheme" class="input" style="max-width:200px">
            <option value="gold">Ø°Ù‡Ø¨ÙŠ</option><option value="blue">Ø£Ø²Ø±Ù‚</option><option value="violet">Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
          </select>
          <input id="posterLogo" class="input" type="file" accept="image/png,image/jpeg" style="max-width:260px" />
          <button class="ghost" onclick="regenPoster()">ØªØ­Ø¯ÙŠØ«</button>
          <button class="gold" onclick="downloadPoster()">ØªÙ†Ø²ÙŠÙ„ PNG</button>
          <button class="x" onclick="closePoster()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div class="poster-wrap"><canvas id="posterCanvas" class="poster" width="1080" height="1080"></canvas></div>
      </div>
    </div>

    <!-- Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù†Ø¬Ø§Ø­ -->
    <div class="card" style="margin-top:16px">
      <h3 class="sec-title">ğŸ“š Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ø³Ø±ÙŠØ¹</h3>
      <ul style="line-height:2;color:var(--muted);font-size:15px;padding-inline:18px">
        <li>Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù‚ØµÙŠØ±Ø© ÙˆÙˆØ§Ø¶Ø­Ø© Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·ØŒ ÙˆØ­Ø·Ù‘ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø£ÙˆÙ„ Ø§Ù„Ø³Ø·Ø±.</li>
        <li>Ø§Ù†Ø´Ø± Ø§Ù„Ø¨ÙˆØ³ØªØ± ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ© (8â€“10Ù…) ÙˆØ§Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…Ø¯Ø¹Ùˆ Ø­ÙØ¸Ù‡.</li>
        <li>Ø°ÙƒÙ‘Ø± Ø§Ù„Ù…Ø¯Ø¹Ùˆ Ø¨ØªØ­Ù‚ÙŠÙ‚ Ø´Ø±ÙˆØ· Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (Ø§Ù„Ø£ÙˆØ¯ÙŠØ´Ù† + 31 Ø³Ø§Ø¹Ø©).</li>
        <li>Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù„ØªØ­Ø¯ÙŠØ¯ Ù‡Ø¯Ù Ø´Ù‡Ø±ÙŠ ÙˆØ§Ù‚Ø¹ÙŠ Ù„Ùƒ ÙˆÙ„ÙØ±ÙŠÙ‚Ùƒ.</li>
      </ul>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Ù…ÙƒØªØ¨Ø§Øª -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script>
    // ØªØ³Ø¬ÙŠÙ„ Service Worker (ØªØ£ÙƒØ¯ Ø£Ù† sw.js Ø¨Ø¬ÙˆØ§Ø± index.html)
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

    const $=s=>document.querySelector(s);
    const liveAmountEl=$("#liveAmount"), darkToggle=$("#darkToggle"), resetBtn=$("#resetBtn");
    const likeeInput=$("#likeeId"), genBtn=$("#genBtn"), inviteCard=$("#inviteCard");
    const codeArea=$("#inviteCode"), linkPreview=$("#inviteLinkPreview"), qrImg=$("#qrImg"), cooldownHint=$("#cooldownHint"), toastEl=$("#toast");
    const simCount=$("#simCount"), simTarget=$("#simTarget"), simPercent=$("#simPercent"), simMonthly=$("#simMonthly"), simQuarter=$("#simQuarter"), simVolume=$("#simVolume");
    let earnChart;

    // Ø¨ÙˆØ³ØªØ±
    const posterModal=$("#posterModal"), posterCanvas=$("#posterCanvas"), pctx=posterCanvas.getContext("2d");
    const posterThemeSel=$("#posterTheme"), posterLogoInput=$("#posterLogo"); let posterLogoImg=null; window.posterTheme='gold';

    // Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
    const achvList=$("#achvList"); let shareCount=parseInt(localStorage.getItem('shareCount')||'0',10);

    // Ø­Ø§Ù„Ù‡ Ø¹Ø§Ù…Ø©
    let counter=0, lastGenTime=0; const COOLDOWN=5; let liveEarnings=0;

    // ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ
    (function initTheme(){
      const t=localStorage.getItem('theme')||'light';
      if(t==='dark') document.body.classList.add('dark');
      darkToggle.onclick=()=>{ document.body.classList.toggle('dark'); localStorage.setItem('theme',document.body.classList.contains('dark')?'dark':'light'); };
    })();

    // ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯
    resetBtn.onclick=()=>{ if(!confirm('Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… ØªØµÙÙŠØ± Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­.')) return; localStorage.setItem('liveEarnings','0'); animateTo(0); };

    function toast(msg){ toastEl.textContent=msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'),1700); }

    // Ø¥Ø¯Ø®Ø§Ù„ Likee ID: Ø­Ø±ÙˆÙ/Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø·
    likeeInput.addEventListener('input',()=>{ const cleaned=(likeeInput.value||'').replace(/\s+/g,'').replace(/[^A-Za-z0-9]/g,''); if(cleaned!==likeeInput.value) likeeInput.value=cleaned; });

    // ØªÙ‡ÙŠØ¦Ø©
    (function init(){
      try{ const saved=localStorage.getItem('likeeId'); if(saved) likeeInput.value=saved; }catch(e){}
      const p=new URLSearchParams(location.search); const urlCode=p.get('code'); if(urlCode) showResult(urlCode);

      const savedAmount=parseFloat(localStorage.getItem('liveEarnings')||'0'); if(savedAmount>0){ liveEarnings=savedAmount; renderAmount(); }
      refreshAchievementsUI();
      buildChart([0,0,0,0],['Ø´Ù‡Ø± 1','Ø´Ù‡Ø± 2','Ø´Ù‡Ø± 3','Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ']);
    })();

    function validateId(id){ return /^[A-Za-z0-9]{3,}$/.test(id); }
    function rand4(){ return Math.floor(1000+Math.random()*9000); }
    function inviteLink(inviteCode){ const base=location.origin+location.pathname; return base+'?code='+encodeURIComponent(inviteCode); }

    function startCooldown(){
      const start=Date.now(); genBtn.disabled=true; cooldownHint.style.display='block';
      const tick=()=>{ const remain=Math.max(0,COOLDOWN-Math.floor((Date.now()-start)/1000));
        cooldownHint.textContent='â³ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± '+remain+' Ø« Ù‚Ø¨Ù„ ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯.';
        if(remain<=0){ genBtn.disabled=false; cooldownHint.style.display='none'; } else setTimeout(tick,250);
      }; tick();
    }

    // Ù„ÙˆØ¬ Ù…Ø­Ù„ÙŠ Ù„Ù„Ø£ÙƒÙˆØ§Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    function logCode(id,code){ const log=JSON.parse(localStorage.getItem('codes_log')||'[]'); log.push({id,code,time:new Date().toISOString()}); localStorage.setItem('codes_log',JSON.stringify(log)); }

    function generateCode(){
      const now=Date.now(); if(now-lastGenTime<COOLDOWN*1000){ startCooldown(); toast('Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ù‹Ø§â€¦'); return; }
      const id=(likeeInput.value||'').trim();
      if(!validateId(id)){ toast('âŒ Likee ID Ù„Ø§Ø²Ù… Ø­Ø±ÙˆÙ/Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (Ù£+).'); likeeInput.focus(); return; }
      try{ localStorage.setItem('likeeId', id); }catch(e){}
      const code=`TH-${id}-${rand4()}`;
      showResult(code);
      sendToGoogleSheet(id,code);
      logCode(id,code);
      lastGenTime=now; startCooldown();
      unlockAchievement('first_code'); if(counter>=10) unlockAchievement('ten_codes');
      if(window.plausible) plausible('generate_code');
    }

    function showResult(code){
      codeArea.textContent=code;
      const link=inviteLink(code);
      linkPreview.textContent=link;
      qrImg.src="https://api.qrserver.com/v1/create-qr-code/?size=170x170&data="+encodeURIComponent(link);
      qrImg.alt="QR to "+link;
      inviteCard.style.display='block';
      incrementCounter();
    }
    function incrementCounter(){ counter++; $("#shareCounter").innerText=`ğŸ’¡ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§/Ø¹Ø±Ø¶Ù‡Ø§: ${counter}`; }

    function copyText(t){ navigator.clipboard.writeText(t).then(()=>toast('ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…')); }
    function copyCode(){ const c=codeArea.textContent.trim(); if(c) copyText(c); }
    function copyLink(){ const l=linkPreview.textContent.trim(); if(l) copyText(l); }

    // UTM
    function addUTM(url,src){ try{ const u=new URL(url); u.searchParams.set('utm_source',src); u.searchParams.set('utm_medium','share'); u.searchParams.set('utm_campaign','referral'); return u.toString(); }catch(_){ return url; } }

    function share(platform){
      const c=codeArea.textContent.trim(); const l0=linkPreview.textContent.trim();
      if(!c||!l0){ toast('ÙˆÙ„Ù‘Ø¯ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ù‹Ø§'); return; }
      const l=addUTM(l0,platform);
      const text=`ğŸ“¢ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ: ${c}\nØ§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù† Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯Ø«!\n${l}`;
      let url="";
      switch(platform){
        case "whatsapp": url=`https://wa.me/?text=${encodeURIComponent(text)}`; break;
        case "telegram": url=`https://t.me/share/url?url=${encodeURIComponent(l)}&text=${encodeURIComponent('Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù†! '+c)}`; break;
        case "messenger": url=`fb-messenger://share/?link=${encodeURIComponent(l)}&app_id=0`; break;
        case "copy": copyText(text); afterShare(); return;
      }
      window.open(url,'_blank');
      afterShare();
    }
    function afterShare(){
      let shareCount=parseInt(localStorage.getItem('shareCount')||'0',10)+1;
      localStorage.setItem('shareCount',String(shareCount));
      unlockAchievement('first_share'); if(shareCount>=10) unlockAchievement('ten_shares');
      if(window.plausible) plausible('share_link');
    }

    // Ø­ÙØ¸ Ø§Ù„ÙƒØ§Ø±Øª ÙƒØµÙˆØ±Ø©
    async function downloadCard(){
      try{
        const node=document.getElementById('inviteCard');
        const canvas=await html2canvas(node,{scale:2,useCORS:true});
        const a=document.createElement('a');
        a.href=canvas.toDataURL('image/png');
        a.download=(codeArea.textContent||'invite').replace(/\s+/g,'')+'.png';
        a.click();
        if(window.plausible) plausible('download_card');
      }catch(e){ toast('ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§'); }
    }

    // Ø¥Ø±Ø³Ø§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø¥Ù„Ù‰ Google Sheet
    function sendToGoogleSheet(likeeId,inviteCode){
      fetch("https://script.google.com/macros/s/AKfycbwtnLPgvBZJ35GlA75TejT4eQVNPQaWRmBD2r4YvRqNCwY91HF3AXiPn4udTANT4zwv/exec",{
        method:"POST", body:new URLSearchParams({likeeId,inviteCode})
      }).then(r=>r.text()).catch(()=>{});
    }

    /* ===== Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ===== */
    function getPercentByTarget(t){
      if(t>=6500000 && t<=10000000) return 0.25;
      if(t>=1000000 && t<=5000000)  return 0.20;
      if(t>=300000 && t<=800000)    return 0.15;
      if(t>=80000  && t<=220000)    return 0.08;
      if(t>=2000   && t<=50000)     return 0.02;
      return 0;
    }
    function fmtUSD(n){ try{return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:0}).format(n||0);}catch(e){return (n||0).toLocaleString()+' $';} }

    function runSimulator(addToCounterOnRun=false){
      const count=Math.max(0,parseInt(simCount.value||'0',10));
      const target=Math.max(0,parseFloat(simTarget.value||'0'));
      if(!count||!target){ simPercent.textContent='â€”'; simMonthly.textContent='â€”'; simQuarter.textContent='â€”'; simVolume.textContent='â€”'; buildChart([0,0,0,0]); return; }

      const pct=getPercentByTarget(target);
      const monthly=count*target*pct, quarter=monthly*3, volume=count*target;

      simPercent.textContent=pct?(pct*100).toFixed(0)+'%':'Ø®Ø§Ø±Ø¬ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­';
      simMonthly.textContent=fmtUSD(monthly);
      simQuarter.textContent=fmtUSD(quarter);
      simVolume.textContent=fmtUSD(volume);

      buildChart([monthly,monthly,monthly,quarter],['Ø´Ù‡Ø± 1','Ø´Ù‡Ø± 2','Ø´Ù‡Ø± 3','Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ']);

      unlockAchievement('sim_used'); if(window.plausible) plausible('run_simulator');

      // ØªØ¶ÙŠÙ Ø¥Ø¬Ù…Ø§Ù„ÙŠ 3 Ø´Ù‡ÙˆØ± Ù„Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­ÙŠ
      if(addToCounterOnRun && quarter>0){ addEarnings(quarter); }
    }

    function buildChart(data,labels){
      const ctx=document.getElementById('earnChart');
      if(earnChart) earnChart.destroy();
      earnChart=new Chart(ctx,{
        type:'bar',
        data:{labels,datasets:[{label:'Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (USD)',data}]},
        options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{callback:v=>fmtUSD(v).replace('$','')+' $'}}}}
      });
    }

    /* ===== Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­ÙŠ ===== */
    function renderAmount(){ liveAmountEl.innerHTML=Math.round(liveEarnings).toLocaleString('en-US')+' <small>USD</small>'; }
    function animateTo(target){
      const start=liveEarnings, diff=target-start, dur=800, t0=performance.now();
      function step(t){
        const p=Math.min(1,(t-t0)/dur);
        liveEarnings=start+diff*(0.5-Math.cos(Math.PI*p)/2);
        renderAmount();
        if(p<1) requestAnimationFrame(step); else localStorage.setItem('liveEarnings',String(liveEarnings));
      }
      requestAnimationFrame(step);
    }
    function addEarnings(amount){
      if(!amount||amount<=0) return;
      animateTo(liveEarnings+amount);
      const coin=document.querySelector('.coin'); coin.style.transform='scale(1.25)'; setTimeout(()=>coin.style.transform='',220);
    }

    /* ===== Ø¨ÙˆØ³ØªØ± ===== */
    function openPoster(){
      if(!codeArea.textContent.trim()){ toast('ÙˆÙ„Ù‘Ø¯ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ù‹Ø§'); return; }
      posterModal.style.display='grid'; regenPoster();
    }
    function closePoster(){ posterModal.style.display='none'; }
    function regenPoster(){
      const code=codeArea.textContent.trim(), link=linkPreview.textContent.trim(), id=(likeeInput.value||'').trim();
      window.posterTheme=posterThemeSel.value||'gold';
      drawPoster({code,link,id});
    }
    function downloadPoster(){
      const a=document.createElement('a'); a.href=posterCanvas.toDataURL('image/png');
      a.download=(codeArea.textContent.trim()||'invite')+'-poster.png'; a.click();
      if(window.plausible) plausible('download_poster');
    }

    posterLogoInput.addEventListener('change',e=>{
      const f=e.target.files&&e.target.files[0]; if(!f) return;
      const reader=new FileReader();
      reader.onload=()=>{ posterLogoImg=new Image(); posterLogoImg.onload=()=>regenPoster(); posterLogoImg.src=reader.result; };
      reader.readAsDataURL(f);
    });

    function drawPoster({code,link,id}){
      const w=posterCanvas.width,h=posterCanvas.height;
      let g1='#1f2937',g2='#2b3545',g3='#3c3f4a',bar='#a67c52';
      if(window.posterTheme==='blue'){ g1='#0f172a'; g2='#0b2748'; g3='#0d3b72'; bar='#2563eb'; }
      if(window.posterTheme==='violet'){ g1='#20113a'; g2='#311b5b'; g3='#4b1d7a'; bar='#a855f7'; }

      // Ø®Ù„ÙÙŠØ©
      const g=pctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0,g1); g.addColorStop(0.6,g2); g.addColorStop(1,g3);
      pctx.fillStyle=g; pctx.fillRect(0,0,w,h);
      pctx.globalAlpha=0.08; pctx.strokeStyle='#fff'; pctx.lineWidth=2;
      for(let r=520;r>60;r-=50){ pctx.beginPath(); pctx.arc(w/2,h/2,r,0,Math.PI*2); pctx.stroke(); }
      pctx.globalAlpha=1;

      // Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ
      pctx.fillStyle=bar; pctx.fillRect(0,0,w,110);
      pctx.fillStyle='#fff'; pctx.font='bold 46px Cairo'; pctx.textAlign='center'; pctx.fillText('Ø¯Ø¹ÙˆØªÙƒ Ø§Ù„Ø®Ø§ØµÙ‘Ø©', w/2,72);

      // Ø¨Ø·Ø§Ù‚Ø© ÙˆØ³Ø·
      const cardSize=w-200, cardX=(w-cardSize)/2, cardY=150;
      pctx.fillStyle='#fff'; roundRect(pctx,cardX,cardY,cardSize,cardSize-80,28,true,false);

      // Ø§Ù„ÙƒÙˆØ¯ + Likee ID
      pctx.fillStyle='#1b5e20'; pctx.font='700 62px Cairo'; pctx.textAlign='center';
      pctx.fillText(code||'TH-XXXX-1234', w/2, cardY+115);
      pctx.fillStyle='#4b5563'; pctx.font='600 30px Cairo';
      pctx.fillText(id?('Likee ID: '+id):'Likee ID', w/2, cardY+165);

      // QR
      const qrSize=360, qrX=w/2-qrSize/2, qrY=cardY+210;
      const qr=new Image(); qr.crossOrigin='anonymous';
      qr.onload=()=>{
        pctx.drawImage(qr,qrX,qrY,qrSize,qrSize);
        // Ø§Ù„Ø±Ø§Ø¨Ø·
        pctx.fillStyle='#111'; pctx.font='600 26px Cairo';
        wrapText(pctx,link||'https://your-link', w/2, qrY+qrSize+50, cardSize-160, 34);
        // Ø¹Ø¨Ø§Ø±Ø©
        pctx.fillStyle='#6b7280'; pctx.font='600 26px Cairo';
        pctx.fillText('Ø´Ø§Ø±Ùƒ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø±Ø§Ø¨Ø· â€“ Ø£Ø±Ø¨Ø§Ø­Ùƒ ØªØ¨Ø¯Ø£ Ù…Ù† Ù‡Ù†Ø§ âœ¨', w/2, cardY+cardSize-42);

        // Ø´Ø¹Ø§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙŠØ·
        if(posterLogoImg){
          const lw=180, lh=180;
          pctx.save(); pctx.beginPath(); pctx.arc(90,90,70,0,Math.PI*2); pctx.closePath(); pctx.clip();
          pctx.drawImage(posterLogoImg,0,0,lw,lh); pctx.restore();
        }
      };
      qr.src="https://api.qrserver.com/v1/create-qr-code/?size="+qrSize+"x"+qrSize+"&data="+encodeURIComponent(link||code||'');
    }

    function roundRect(ctx,x,y,w,h,r,fill=true,stroke=false){
      ctx.beginPath(); ctx.moveTo(x+r,y);
      ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r);
      ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r);
      ctx.closePath(); if(fill) ctx.fill(); if(stroke) ctx.stroke();
    }
    function wrapText(ctx,text,centerX,startY,maxWidth,lineHeight){
      const words=(text||'').split(' '); let line='',y=startY; ctx.textAlign='center';
      for(let n=0;n<words.length;n++){
        const test=line+words[n]+' '; const w=ctx.measureText(test).width;
        if(w>maxWidth && n>0){ ctx.fillText(line.trim(),centerX,y); line=words[n]+' '; y+=lineHeight; }
        else line=test;
      }
      ctx.fillText(line.trim(),centerX,y);
    }

    /* Ø¥Ù†Ø¬Ø§Ø²Ø§Øª */
    function refreshAchievementsUI(){
      ['first_code','ten_codes','sim_used','first_share','ten_shares'].forEach(k=>{
        const el=achvList.querySelector(`[data-key="${k}"]`); if(!el) return;
        const unlocked=localStorage.getItem('achv_'+k)==='1'; el.classList.toggle('lock',!unlocked);
      });
    }
    function unlockAchievement(key){
      const s='achv_'+key; if(localStorage.getItem(s)==='1') return;
      localStorage.setItem(s,'1'); refreshAchievementsUI(); toast('ğŸ… Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯!');
    }
  </script>
</body>
</html>
